{% extends "base.html.twig" %}

{% block title %}Liste des livres{% endblock %}
{% block content %}
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1>Bibliothèque du Patrimoine</h1>
        <a href="create.php" class="btn-add">Ajouter un livre</a>
    </div>

    {# FORMULAIRE DE RECHERCHE #}
    <form action="" method="GET" >
        <label for="search">Rechercher :</label>
        <input type="text" name="search" id="search" value="{{ search }}" placeholder="Titre ou auteur...">
        <button type="submit">Rechercher</button>
        {% if search %}
            <a href="?">Réinitialiser</a>
        {% endif %}
    </form>

    <table>
        <tr>
            <th>Référence</th>
            <th>Titre</th>
            <th>Auteur</th>
            <th>Actions</th>
        </tr>
        {% for document in list %}
            <tr>
                <td>{{ document._id }}</td>
                <td>{{ document.titre }}</td>
                <td>{{ document.auteur }}</td>
                <td>
                    <a href="get.php?id={{ document._id }}">voir</a> /
                    <a href="edit.php?id={{ document._id }}">éditer</a> /
                    <a href="delete.php?id={{ document._id }}">supprimer</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="4" style="text-align:center">Aucun résultat trouvé pour "{{ search }}".</td>
            </tr>
        {% endfor %}
    </table>

    {# PAGINATION  #}
    {% if maxPages > 1 %}
        <div class="pagination" style="margin-top: 20px; text-align: center; display: flex; justify-content: center; gap: 10px;">

            {# On ajoute &search={{ search }} à tous les liens #}

            {# Boutons Précédents #}
            {% if page > 1 %}
                <a href="?page=1&search={{ search }}">&laquo;&laquo;</a>
                <a href="?page={{ page - 1 }}&search={{ search }}">&laquo; Précédent</a>
            {% else %}
                <span style="color: grey;">&laquo;&laquo;</span>
                <span style="color: grey;">&laquo; Précédent</span>
            {% endif %}

            {# Formulaire de saut direct #}
            <form action="" method="GET" style="display: inline-block; margin: 0;">
                {# On garde la recherche active même quand on saute de page #}
                <input type="hidden" name="search" value="{{ search }}">

                <input type="number" name="page" value="{{ page }}" min="1" max="{{ maxPages }}" style="width: 50px;">
                <span> / {{ maxPages }}</span>
                <button type="submit">Aller</button>
            </form>

            {# Boutons Suivants #}
            {% if page < maxPages %}
                <a href="?page={{ page + 1 }}&search={{ search }}">Suivant &raquo;</a>
                <a href="?page={{ maxPages }}&search={{ search }}">&raquo;&raquo;</a>
            {% else %}
                <span style="color: grey;">Suivant &raquo;</span>
                <span style="color: grey;">&raquo;&raquo;</span>
            {% endif %}

        </div>
    {% endif %}
{% endblock %}